
$script1 = <<-SCRIPT
apt-get update -y
apt-get install -y ansible-core apache2 php libapache2-mod-php mysql-server python3-pip
ansible-galaxy collection install community.mysql
sudo systemctl enable mysql
apt-get install python3-pip -y
SCRIPT


#spécification de la box (image) pour créer la vm
Vagrant.configure("2") do |config|
  # Common configuration
  config.vm.box = "hashicorp-education/ubuntu-24-04"
  config.vm.box_version = "0.1.0"
  
config.vm.network "forwarded_port", guest: 80, host: 8080

#installer Docker 
 config.vm.provision "shell", name: "install-docker", path: "install-docker.sh"

#installer ansible-core apache2 php libapache2-mod-php mysql-server python3-pip 
 config.vm.provision "shell", inline: $script1

#importation de index.php dans la vm
config.vm.provision "shell", inline: <<-SHELL
 sudo chown -R vagrant:vagrant /var/www/html
 SHELL
 config.vm.provision "file", source: "webapp/index.php", destination: "/var/www/html/index.php"


config.vm.provision "shell", inline: "test -d /home/vagrant/ansible || mkdir /home/vagrant/ansible"
config.vm.provision "shell", inline: <<-SHELL
  sudo chown -R vagrant:vagrant /home/vagrant/ansible
 SHELL
config.vm.provision "file", source: "playbook.yml", destination: "/home/vagrant/ansible/playbook.yml"


#execution de playbook.yml
  config.vm.provision "shell", inline:  "ansible-playbook -i localhost, #/home/vagrant/ansible/playbook.yml"

end







